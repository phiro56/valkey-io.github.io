{% extends "left-aside.html" %}

{% import "macros/docs.html" as docs %}

{%- block head -%}
{% set docs_file_contents = docs::load(slug= page.slug) %}
{# detect front matter #}
{% set frontmatter = docs::extract_frontmatter(content= docs_file_contents) %}
{% set frontmatter_length = frontmatter | length() %}
{% if frontmatter_length > 0 %}
    {% set frontmatter_data = load_data(literal= frontmatter, format="yaml") %}
    {% set has_frontmatter = true %}
    {% set page_contents = docs::extract_markdown(content= docs_file_contents) %}
    {% if frontmatter_data.title %}
        {% set frontmatter_title = frontmatter_data.title %}
    {% endif %} 
{% else %}
    {% set page_contents = docs_file_contents %}
{% endif %}
{%- endblock head -%}

{% block subhead_content %}
{% if has_frontmatter and frontmatter_title %}
    <div class="styled-title">
        <h1 class="page-title">Documentation: {{ frontmatter_title }}</h1>
    </div>
{% endif  %}
{% endblock subhead_content %}

{% block breadcrumbs %}
{# Breadcrumbs section #}
<nav class="breadcrumbs">
    <ul class="breadcrumb-list">
        <li class="breadcrumb-item">
            <a href="/topics/" class="breadcrumb-link">Topics</a>
        </li>
        <li class="breadcrumb-item breadcrumb-current" aria-current="page">
            <img src="/img/caret-right.svg" alt="Caret Right Icon" width="8" height="10"/>
            {% if frontmatter_title %}{{ frontmatter_title }}{% else %}{{ page.slug | upper }}{% endif %}
        </li>
    </ul>
</nav>
{% endblock breadcrumbs %}

{% block main_content %}
{% if config.extra.review_list is containing(page.path) %}
<p><strong>This page is under review.</strong> The page is likely incorrect, contains invalid links, and/or needs technical review. 
    In the future it may change substantially or be removed entirely.</p>
<hr />
{% endif %}
{%- set content_with_fixed_links = docs::fix_links(content= page_contents) -%}
{% if config.extra.publish_hold is containing(page.path) %}
    <p><code>{{ page.path }}</code> may be available after revisions.</p>
{% else %}
    {{ content_with_fixed_links | markdown | safe }}
{% endif %}
{% endblock main_content %}

{% block related_content %}
<div class="sb-search-container">
    <input type="text" id="sidebar-search-box" placeholder="Search within topics" onkeyup="searchSidebarTopics()" />
</div>

<!-- No results message for sidebar search -->
<div id="sidebar-no-results-message" class="no-results-message" style="display: none;">
    <span>&lt;/&gt;</span>
    <h4>No topics found</h4>
    <p>Check your spelling or try different keywords</p>
</div>

<h2 id="topic-list-title">Alphabetical Index</h2>
<ul id="topic-list"></ul>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var 
        topicListEl = document.getElementById('topic-list'),
        f = fetch("/topics-list/");

    f.then((r) => r.text()).then((v) => { topicListEl.innerHTML = v; })
    f.catch((error) => { topicListEl.innerHTML = "Could not load topic list."; });
});

function searchSidebarTopics() {
    var input = document.getElementById("sidebar-search-box").value.toLowerCase();
    var topicList = document.getElementById("topic-list");
    var topicListTitle = document.getElementById("topic-list-title");
    var items = topicList.querySelectorAll(".topic-list-item");
    var noResultsMessage = document.getElementById("sidebar-no-results-message");
    var totalVisible = 0;

    items.forEach(function (item) {
        var text = item.querySelector("a").innerText.toLowerCase();
        if (text.includes(input)) {
            item.style.display = "";
            totalVisible++;
        } else {
            item.style.display = "none";
        }
    });

    // Show/hide no results message and title based on search results
    var hasResults = totalVisible > 0;
    noResultsMessage.style.display = hasResults ? "none" : "block";
    topicListTitle.style.display = hasResults ? "" : "none";
    topicList.style.display = hasResults ? "" : "none";
}
</script>

<div class="edit_box">
    See an error?
    <a href="https://github.com/valkey-io/valkey-doc/edit/main/topics/{{ page.slug }}.md">Update this Page on GitHub!</a>
</div>
{% endblock related_content %}
